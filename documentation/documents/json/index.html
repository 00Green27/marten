<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>Marten - Json Serialization</title>
		<link href="/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="/content/prism.css" rel="stylesheet" type="text/css" />
		<link href="/content/theme.css" rel="stylesheet" type="text/css" />
		
        

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">


        <!-- CSS code from Bootply.com editor -->
        <link href="/content/affix.css" rel="stylesheet" type="text/css" />
    </head>
    
    <!-- HTML code from Bootply.com editor -->
    
    <body  >

<a href="https://github.com/jasperfx/marten"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
        
        <nav class="navbar navbar-default navbar-fixed-top" role="banner">
		  <div class="container">
		    <div class="navbar-header">
		      <a href="/" class="navbar-brand">Marten</a>
		    </div>
		    <nav class="collapse navbar-collapse" role="navigation">
		      <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/getting_started">Getting Started</a>
            </li>
		        <li>
		          <a href="/documentation">Documentation</a>
		        </li>
		        <li>
<a href="https://gitter.im/jasperfx/marten?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/jasperfx/marten" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
		        </li>
		      	<li><a href="/documentation/documents/document_ids" title="Document Id's">Previous</a></li>
		      	<li><a href="/documentation/documents/linq" title="Querying Documents with Linq">Next</a></li>
		      </ul>
      <div class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input id="search" type="search" class="form-control" placeholder="Search">
        </div>
      </div>

		    </nav>

		  </div>
		</nav>

		  <div class="container">
		  	<nav class="navbar-inverse">
		  		<ol class="breadcrumb"><li><a href="/">Marten</a></li><li><a href="/documentation">Documentation</a></li><li><a href="/documentation/documents">Marten as Document Db</a></li><li class="active">Json Serialization</li></ol>
		  	</nav>
		  </div>

		<!--main-->
		<div class="container">
			<div class="row">
		      <!--left-->
		      
		      <div class="col-md-3" id="leftCol">
		      	<h3>Marten 0.5.0</h3>
		      	<br />

				<ul class="nav nav-stacked affix" id="sidebar">

		        </ul>

		        	<h3 class="no-margin">Next</h3><p><a href="/documentation/documents/linq">Querying Documents with Linq</a></p>
		        	<h3 class="no-margin">Previous</h3><a href="/documentation/documents/document_ids">Document Id's</a></p>

		        </ul>
		      </div><!--/left-->
		      
		      <!--right-->
		      <div class="col-md-9">
			      	<h1>Json Serialization</h1>
			      
			      	<hr />

			      	<div id="main-pane">
			      		<!--Title:Json Serialization-->
<!--Url:json-->
<p>An absolutely essential ingredient in Marten's persistence strategy is JSON serialization of the document objects. Marten aims to make the
JSON serialization extensible and configurable through the native mechanisms in each JSON serialization library.</p>
<p>Internally, Marten uses an adapter interface for JSON serialization:</p>
<pre><code class="language-csharp">
    public interface ISerializer
    {
        string ToJson(object document);
        T FromJson&lt;T&gt;(string json);
        T FromJson&lt;T&gt;(Stream stream);

        object FromJson(Type type, string json);

        /// &lt;summary&gt;
        /// Serialize a document without any extra
        /// type handling metadata
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;document&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        string ToCleanJson(object document);
    }
</code></pre>
<p>To support a new serialization library or customize the JSON serialization options, you can write a new version of <code>ISerializer</code> and plug it
into the <code>DocumentStore</code> (there's an example of doing that in the section on using Jil).</p>
<h2>Serializing with Newtonsoft.Json</h2>
<p>The default JSON serialization strategy inside of Marten uses <a href="http://www.newtonsoft.com/json">Newtonsoft.Json</a>. We have standardized on Newtonsoft.Json
because of its flexibility and ability to handle polymorphism within child collections and eventually <a href="https://github.com/JasperFx/Marten/issues/44">document hierarchies</a>.</p>
<h2>Serializing with Jil</h2>
<p>Marten has also been tested using the <a href="https://github.com/kevin-montrose/Jil">Jil library</a> for JSON serialization. While Jil is not as
flexible as Newtonsoft.Json and might be missing support for some scenarios you may encounter, it is very clearly faster than Newtonsoft.Json.</p>
<p>To use Jil inside of Marten, add a class to your system like this one that implements the <code>ISerializer</code> interface:</p>
<pre><code class="language-csharp">
    public class JilSerializer : ISerializer
    {
        private readonly Options _options 
            = new Options(dateFormat: DateTimeFormat.ISO8601);

        public string ToJson(object document)
        {
            return JSON.Serialize(document, _options);
        }

        public T FromJson&lt;T&gt;(string json)
        {
            return JSON.Deserialize&lt;T&gt;(json, _options);
        }

        public T FromJson&lt;T&gt;(Stream stream)
        {
            return JSON.Deserialize&lt;T&gt;(new StreamReader(stream), _options);
        }

        public object FromJson(Type type, string json)
        {
            return JSON.Deserialize(json, type, _options);
        }

        public string ToCleanJson(object document)
        {
            return ToJson(document);
        }
    }
</code></pre>
<p>Next, replace the default <code>ISerializer</code> when you bootstrap your <code>DocumentStore</code> as in this example below:</p>
<pre><code class="language-csharp">
            var store = DocumentStore.For(_ =&gt;
            {
                _.Connection(&quot;the connection string&quot;);

                // Replace the ISerializer w/ the JilSerializer
                _.Serializer&lt;JilSerializer&gt;();
            });
</code></pre>
<p>See <a href="http://jeremydmiller.com/2015/11/09/optimizing-for-performance-in-marten/">Optimizing for Performance in Marten</a>
and <a href="http://jeremydmiller.com/2015/11/30/optimizing-marten-part-2/">Optimizing Marten Part 2</a> for some performance comparisons
of using Jil versus Newtonsoft.Json for serialization within Marten operations.</p>


			      	</div>

			      	<hr />

			      	<nav>
				        <span>
				        	<strong>Previous: </strong><a href="/documentation/documents/document_ids">Document Id's</a>

				        </span>
				        <span class="pull-right">

				        	<strong>Next: </strong><a href="/documentation/documents/linq">Querying Documents with Linq</a>

				        </span>
			      	</nav>

		      </div><!--/right-->
		  	</div><!--/row-->
		</div><!--/container-->


    </body>


    <foot>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/content/embed.js"></script>
        <script type="text/javascript" src="/content/prism.js"></script>
        <script type="text/javascript" src="/content/sidebar.js"></script>
        <script type="text/javascript" src="/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:jasperfx.github.io ' + search;
    url = encodeURI(url);

    //alert(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }



}); 

</script>
    </foot>
</html>

